/****************************************************************************** 
This is to certify that this project is my own & partners work, based on  
my/our personal efforts in studying and applying the concepts learned. I/we 
have constructed the functions and their respective algorithms and 
corresponding code by me (and my partner). The program was run, tested, and  
debugged by my own efforts. I further certify that I have not copied in  
part or whole or otherwise plagiarized the work of other students and/or  
persons.  
<Rein Dela Cruz> - <12206032> - <S12>  
<Frederick Garcia> - <12206970> - <S11>  
******************************************************************************/
// gcc -Wall CCPROG2MP.c -o run.exe

#include <stdio.h>
#include <string.h> // String things
#include <conio.h> // getch();
#include <stdlib.h> // system("cls")
#include "dataValidation.c" // Validation functions

/*
? Needed info about the users
* First & Last name
* ID Number
* Year & Program
* Date & Time fro Reservation
* Number of Participants
* Room to Reserved (preferred)
* Description of the Activity (short)
*/


struct Reservation{
    int userID;   // User ID number
    string50 fullName; // User's full name
    string50 yearProgram; // Year and program of the user
    int dateM; // Reservation date 
    int dateD; // Reservation date
    int dateY; // Reservation date
    string50 timeSlot; // Time slot for the reservation
    int numParticipants; // Number of participants for the reservation
    string20 roomName; // Room name reserved (e.g., A0607)
    string1000 activityDesc; // Description of the activity
};

struct Room{
    char name[10]; // A0607
    char type[20]; // Room type
    int capacity;  // Room capacity
    int status; // Availability status (1 if available, 0 if booked)
};

int Input_form(struct Reservation *A, int records, struct Room *B, char *dayT, int dateM, int dateD, int dateY)
{
    char MTHF[][16] = {"09:15 - 10:45", "11:00 - 12:30", "12:45 - 14:15", "14:30 - 16:00", "16:15 - 17:45", "18:00 - 19:00"};
    char WS[][16] = {"09:00 - 12:00", "13:00 - 16:00", "16:15 - 19:15"};
    int timeC, i, day = 0, check = 0, choice, cant, dateCheck = 0;
    int TdateM, TdateD, TdateY, TuserID, TnumP;
    char TroomN[10];

    system("cls");

    if((strcmp(dayT, "Mon") == 0) || (strcmp(dayT, "Tue") == 0) || (strcmp(dayT, "Thu") == 0) || (strcmp(dayT, "Fri") == 0))
        day = 1;


    while(check != 1)
    {
        printf("\nEnter your ID number: ");
        scanf("%d", &TuserID);

        if(TuserID < 10000000 || TuserID >= 20000000)
            printf("Invalid input. Please try again.\n");

        else if(TuserID > 10000000 && TuserID < 20000000)
        {
            A[records].userID = TuserID;
            check = 1;
        }
    }
    

    printf("Enter your full name (First and Last Name): ");
    fgets(A[records].fullName, sizeof(A[records].fullName), stdin);

    int len = strlen(A[records].fullName);
    if (len > 0 && A[records].fullName[len - 1] == '\n')
        A[records].fullName[len - 1] = '\0';

    int c;
    while ((c = getchar()) != '\n' && c != EOF);

    printf("Enter your year and program: ");
    fgets(A[records].yearProgram, sizeof(A[records].yearProgram), stdin);
    
    len = strlen(A[records].yearProgram);
    if (len > 0 && A[records].yearProgram[len - 1] == '\n')
        A[records].yearProgram[len - 1] = '\0';

    check = 0;
    while (check != 1)
    {
        printf("Enter the date for the reservation (MM/DD/YY): ");
        int date = scanf("%d/%d/%d", &TdateM, &TdateD, &TdateY);

        if (date != 3 || getchar() != '\n')
        {
            TdateM = 0;
            TdateD = 0;
            TdateY = 0;
            printf("Invalid date format. Please enter the date in MM/DD/YY format.\n");
        }

        else
        {
            dateCheck = dateValid(TdateD, TdateM, TdateY);
            if(dateCheck == 0)
            {
                TdateM = 0;
                TdateD = 0;
                TdateY = 0;
                printf("Invalid date. Please enter a valid date.\n");
            }
            else
            {
                int dateCCheck = compareDate(dateM, dateD, dateY, TdateM, TdateD, TdateY);

                if(dateCCheck == 1)
                {
                    A[records].dateD = TdateD;
                    A[records].dateM = TdateM;
                    A[records].dateY = TdateY;
                    check = 1;
                }

                else
                {
                    TdateM = 0;
                    TdateD = 0;
                    TdateY = 0;
                    printf("Invalid date. Please enter a future date.\n");
                }
            }
                
        }
    }

    check = 0;
    while(check != 1)
    {
        printf("Choose a time slot\n");
        if(day == 1)
        {
            for(i = 0; i < 6; i++)
            {
                printf("[%d] %s\n", i+1, MTHF[i]);
            }
        }

        else
        {
            for(i = 0; i < 3; i++)
            {
                printf("[%d] %s\n", i+1, WS[i]);
            }
        }

        printf("Enter the time slot for the reservation: ");
        scanf("%d", &timeC);

        if((timeC < 1 || timeC > 6) && day == 1)
            printf("Invalid input. Please choose from the list.\n");
        else if((timeC < 1 || timeC > 3) && day == 0)
            printf("Invalid input. Please choose from the list.\n");
        else
            check = 1;
    }

    check = 0;
    choice = 0;
    cant = 0;
    while(check != 1)
    {
        printf( "Would your activity last for more than 1.5 hours?\n"
                "[1] Yes\n"
                "[2] No\n");
        scanf("%d", &choice);

        if(choice == 1 && day == 1 && MTHF[timeC][0] != '\0')
        {
            for (i = 0; i < records; i++)
            {
                if(strcmp(A[i].timeSlot, MTHF[timeC]) == 0 && day == 1 && (A[records].dateM == A[i].dateM && A[records].dateD == A[i].dateM && A[records].dateY == A[i].dateY))
                    cant = 1; // if the next time slot is not available
                else
                    cant = 0;
            }
        }

        
        else if(choice == 1 && day != 1 && WS[timeC][0] != '\0')
        {
            for (i = 0; i < records; i++)
            {
                if(strcmp(A[i].timeSlot, WS[timeC]) == 0 && day == 1 && (A[records].dateM == A[i].dateM && A[records].dateD == A[i].dateM && A[records].dateY == A[i].dateY))
                    cant = 1; // if the next time slot is not available
                else
                    cant = 0;
            }
        }

        else
            cant = 1;


        switch(choice)
        {
            case 1:
                if(cant == 0)
                {
                    printf("Reserving the next time slot.\n");
                    if(day == 1)
                    {
                        strcpy(A[records].timeSlot, MTHF[timeC-1]);
                        strcat(A[records].timeSlot, " & ");
                        strcat(A[records].timeSlot, MTHF[timeC]);
                    }

                    else
                    {
                        strcpy(A[records].timeSlot, WS[timeC-1]);
                        strcat(A[records].timeSlot, " & ");
                        strcat(A[records].timeSlot, WS[timeC]);
                    }
                    check = 1;
                }

                else
                {
                    printf("Can't reserve the next time slot. Reserving just the chosen time slot");
                    if(day == 1)
                        strcpy(A[records].timeSlot, MTHF[timeC-1]);

                    else
                        strcpy(A[records].timeSlot, WS[timeC-1]);

                }
                break;

            case 2:
                if(day == 1)
                    strcpy(A[records].timeSlot, MTHF[timeC-1]);

                else
                    strcpy(A[records].timeSlot, WS[timeC-1]);

                check = 1;
                break;
                
            default:
                printf("Invalid input.");
                break;
        }
    }

    

    check = 0;
    while(check != 1)
    {
        printf("Enter the number of participants: ");
        scanf("%d", &TnumP);

        if(TnumP > 150)
            printf("Capacity has reached our limit for all of our rooms!\n");
        else
        {
            A[records].numParticipants = TnumP;
            check = 1;
        }


    }

    choice = 0;
    check = 0;
    char roomNames[][10] = {"Y0101", "Y0102", "Y0103", "Y0104", "Y0105", "Y0106", "Y0107", "Y0108", "Y0109", "Y0110"};
    while(check != 1)
    {
        printf("Enter the room name to reserve (Y0101 - Y0110): ");
        scanf("%s", TroomN);

        for(i = 0; i < 10; i++)
        {
            if(strcmp(roomNames[i], TroomN) == 0) // Valid room name
            {
                if(A[records].numParticipants > 30 && (strcmp(roomNames[0], TroomN) == 0 || strcmp(roomNames[1], TroomN) == 0 || 
                    strcmp(roomNames[2], TroomN) == 0 || strcmp(roomNames[3], TroomN) == 0 || strcmp(roomNames[4], TroomN) == 0
                    || strcmp(roomNames[5], TroomN) == 0))
                        printf("Number of participants is over the capacity of the room you want. Please choose another room.\n");

                else if(A[records].numParticipants > 80 && (strcmp(roomNames[6], TroomN) == 0 || strcmp(roomNames[7], TroomN) == 0))
                    printf("Number of participants is over the capacity of the room you want. Please choose another room.");

                else if(A[records].numParticipants > 100 && strcmp(roomNames[8], TroomN) == 0)
                    printf("Number of participants is over the capacity of the room you want. Please choose another room.");
                
                else if(A[records].numParticipants > 150 && strcmp(roomNames[9], TroomN) == 0)
                    printf("Capacity has reached our limit for all of our rooms! Please lower the participants of your activity");
            }

            else // Invalid room name
                choice = 1;
        }

        if (choice == 1)
            printf("Invalid room name. Please choose between Y0101 - Y0110");

        else
            check = 1;
        
    }
    


    printf("Enter the description of the activity: ");
    scanf("%s", A[records].activityDesc);


    return 1;
}

void initializeRooms(struct Room *A, int numRooms) // Since kunti lang naman saatin 
{
    char roomNames[][10] = {"Y0101", "Y0102", "Y0103", "Y0104", "Y0105", "Y0106", "Y0107", "Y0108", "Y0109", "Y0110"};
    char roomTypes[][20] = {"classroom", "classroom", "classroom", "classroom", "classroom", "classroom", "Seminar room", "Seminar room", "Training room", "Auditorium"};
    int roomCapacities[] = {30, 30, 30, 30, 30, 30, 80, 80, 100, 150};

    for (int i = 0; i < numRooms; i++) {
        strcpy(A[i].name, roomNames[i]);
        strcpy(A[i].type, roomTypes[i]);
        A[i].capacity = roomCapacities[i];
        A[i].status = 1;
    }
}





int adminMenu(int dateM, int dateD, int dateY, char *dayT)
{
    system("cls");
    int choice;
    do
    {
        printf( "\nWhat do you want to do?\t Date: %d/%d/%d \t Day: %s\n"
                "[1] Remove a reservation\n"
                "[2] Change a reservation\n"
                "[3] Edit a reservation\n"
                "[5] Complete a reservation\n"
                "[6] Go back to main menu\n", dateM, dateD, dateY, dayT);
        printf("Input choice: ");
        scanf("%d", &choice);

        if(choice < 1 || choice > 6)
            printf("Invalid input. Please choose from the list.\n");

    } while(choice < 1 || choice > 6);
        

    
    return choice;
}


int main(){
    
    // Main menu variables
    int mainChoice, exit = 0, pCheck = 0, records = 0;
    string20 correctP = "Password", inputP;
    struct Room rooms[10];
    struct Reservation data[MAX];
    
    
    initializeRooms(rooms, 10);


    // Date and day variables
    int dateM, dateD, dateY, date, dateCheck = 0, dayCheck = 0;
    char dayT[4];
    do
    {
        printf("Enter todays date(MM/DD/YY): ");
        date = scanf("%d/%d/%d", &dateM, &dateD, &dateY);

        if (date != 3 || getchar() != '\n')
        {
            dateM = 0;
            dateD = 0;
            dateY = 0;
            printf("Invalid date format. Please enter the date in MM/DD/YY format.\n");
        }
        
        else
        {
            dateCheck = dateValid(dateM, dateD, dateY);

            if(dateCheck == 0)
            {
                dateM = 0;
                dateD = 0;
                dateY = 0;
                printf("Invalid date. Please input a proper date.\n");
            }
                
        }
            
            
        


    } while(dateCheck != 1); // Date input

    do {
        printf("\nEnter the day today (Mon, Tue, Wed..., Sat): ");
        scanf("%s", dayT);

        if (dayT[0] >= 'a' && dayT[0] <= 'z') 
            dayT[0] = dayT[0] - 32;
        // Consume leftover characters in the input buffer, including the newline character
        int c;
        while ((c = getchar()) != '\n' && c != EOF);

        dayCheck = dayValid(dayT);

        if (dayCheck == 0) {
            printf("Invalid day. Input a day from Mon to Sat only. No reservations for Sun.\n");
        }

    } while (dayCheck != 1); // Day input
    

    system("cls");
    
    do
    {
        printf("\nWhat would you like to do?\t Date: %d/%d/%d \t Day: %s\n", dateM, dateD, dateY, dayT);

        printf( "[1] Book a reservation\n"
                "[2] Cancel a reservation\n"
                "[3] Change a reservation\n"
                "[4] Admin module\n"
                "[5] Exit program\n");
        printf("Input choice: ");
        scanf("%d", &mainChoice);

        switch (mainChoice)
        {
        case 1:
            records += Input_form(data, records, rooms, dayT, dateM, dateD, dateY);
            break;
        case 2:
            printf("You chose 2");
            break;
        case 3:
            printf("You chose 3");
            break;
        case 4:
            while(pCheck != 1)
            {
                password(inputP);
                if(strcmp(correctP, inputP) == 0 || inputP[0] == '\0') // Password
                    pCheck = 1;
                else
                    printf("Wrong password. Please try again.");
            }

            if(pCheck == 1)
                adminMenu(dateM, dateD, dateY, dayT);
            
            break;
        case 5:
            printf("Thank you for using our program!");
            exit = 1;
            break;
        
        default:
            printf("Invalid input. Please choose from the given list.");
            break;
        }
    } while(exit != 1);
        


    return 0;
}
